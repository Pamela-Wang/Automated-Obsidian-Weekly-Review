'use strict';

var obsidian = require('obsidian');

/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var TaskType;
(function (TaskType) {
    TaskType["TODO"] = "TODO";
    TaskType["DONE"] = "DONE";
    TaskType["DOING"] = "DOING";
    TaskType["LATER"] = "LATER";
    TaskType["CANCELED"] = "CANCELED";
    TaskType["UNKNOWN"] = "UNKNOWN";
})(TaskType || (TaskType = {}));
var TaskCSSClass;
(function (TaskCSSClass) {
    TaskCSSClass["COMPLETE"] = "logseq-complete-task";
    TaskCSSClass["INCOMPLETE"] = "logseq-incomplete-task";
    TaskCSSClass["KEYWORD"] = "logseq-keyword";
})(TaskCSSClass || (TaskCSSClass = {}));
var VERSION = "0.0.4";
var LogSeqRegExes = /** @class */ (function () {
    function LogSeqRegExes() {
    }
    LogSeqRegExes.parseTaskType = function (content) {
        if (content.startsWith("DONE ")) {
            return TaskType.DONE;
        }
        else if (content.startsWith("TODO ")) {
            return TaskType.TODO;
        }
        else if (content.startsWith("DOING ")) {
            return TaskType.DOING;
        }
        else if (content.startsWith("LATER ")) {
            return TaskType.LATER;
        }
        else if (content.startsWith("CANCELED ")) {
            return TaskType.CANCELED;
        }
        else {
            return TaskType.UNKNOWN;
        }
    };
    LogSeqRegExes.isBlock = function (content) {
        return LogSeqRegExes.BEGIN_BLOCK_REGEX.test(content);
    };
    LogSeqRegExes.HEADING_REGEX = {
        h1: /(?:\s+)?- # (?:.*)$/gms,
        h2: /(?:\s+)?- ## (?:.*)$/gms,
        h3: /(?:\s+)?- ### (?:.*)$/gms,
        h4: /(?:\s+)?- #### (?:.*)$/gms,
        h5: /(?:\s+)?- ##### (?:.*)$/gms,
    };
    LogSeqRegExes.BEGIN_BLOCK_REGEX = new RegExp(/\#\+BEGIN_(WARNING|IMPORTANT|QUOTE|CAUTION)/gms);
    LogSeqRegExes.END_BLOCK_REGEX = new RegExp(/\#\+END_(WARNING|IMPORTANT|QUOTE|CAUTION)/gms);
    return LogSeqRegExes;
}());
var CodeMirrorOverlays = /** @class */ (function () {
    function CodeMirrorOverlays() {
    }
    CodeMirrorOverlays.cmAddHeadingOverlay = function (cm) {
        cm.addOverlay(CodeMirrorOverlays.headingsOverlay);
    };
    CodeMirrorOverlays.cmRemoveHeadingOverlay = function (cm) {
        cm.removeOverlay(CodeMirrorOverlays.headingsOverlay);
    };
    CodeMirrorOverlays.headingsOverlay = {
        token: function (stream) {
            if (stream.match(LogSeqRegExes.HEADING_REGEX["h1"])) {
                return "header-1";
            }
            else if (stream.match(LogSeqRegExes.HEADING_REGEX["h2"])) {
                return "header-2";
            }
            else if (stream.match(LogSeqRegExes.HEADING_REGEX["h3"])) {
                return "header-3";
            }
            else if (stream.match(LogSeqRegExes.HEADING_REGEX["h4"])) {
                return "header-4";
            }
            else if (stream.match(LogSeqRegExes.HEADING_REGEX["h5"])) {
                return "header-5";
            }
            else {
                stream.next();
            }
        },
    };
    return CodeMirrorOverlays;
}());
function createKeywordElement(keyword) {
    var element = document.createElement("span");
    element.classList.add(TaskCSSClass.KEYWORD);
    element.textContent = keyword;
    return element;
}
function createCheckboxElement(checked) {
    if (checked === void 0) { checked = false; }
    var element = document.createElement("input");
    element.type = "checkbox";
    element.checked = checked;
    return element;
}
var LogSeqPlugin = /** @class */ (function (_super) {
    __extends(LogSeqPlugin, _super);
    function LogSeqPlugin() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LogSeqPlugin.removeProperties = function (content) {
        return content
            .replace(/doing:: (?:\d{13})/, "")
            .replace(/done:: (?:\d{13})/, "")
            .replace(/todo:: (?:\d{13})/, "")
            .replace(/doing:: (?:\d{13})/, "")
            .replace(/later:: (?:\d{13})/, "")
            .replace(/canceled:: (?:\d{13})/, "")
            .replace(/id:: (?:[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12})/i, "")
            .replace(/collapsed:: (?:true|false)/gms, "");
    };
    LogSeqPlugin.processChildren = function (el, keyword) {
        el.childNodes.forEach(function (child) {
            if (child.nodeType == Node.TEXT_NODE) {
                if (child.nodeValue.startsWith(keyword)) {
                    child.nodeValue = child.nodeValue.replace(keyword, "");
                }
                child.nodeValue = LogSeqPlugin.removeProperties(child.nodeValue);
            }
        });
    };
    LogSeqPlugin.styleNode = function (el, classname) {
        el.querySelectorAll("li[data-line]").forEach(function (child) {
            // Do not "complete" the child tasks, since this is LogSeq's behaviour
            child.classList.add(TaskCSSClass.INCOMPLETE);
        });
        el.classList.add(classname);
    };
    LogSeqPlugin.prototype.onload = function () {
        console.log("Loading logseq-compat plugin " + VERSION);
        this.registerMarkdownPostProcessor(LogSeqPlugin.postprocessor);
        // Style headings in source editing
        this.registerCodeMirror(CodeMirrorOverlays.cmAddHeadingOverlay);
    };
    LogSeqPlugin.prototype.onunload = function () {
        console.log("unloading logseq-compat plugin " + VERSION);
        this.registerCodeMirror(CodeMirrorOverlays.cmRemoveHeadingOverlay);
    };
    LogSeqPlugin.postprocessor = function (el, ctx) {
        var entries = el.querySelectorAll("li[data-line]");
        entries.forEach(function (entry) {
            // Check if the entry is a org-mode block
            if (LogSeqRegExes.isBlock(entry.innerHTML)) {
                var replacedBlock = entry.innerHTML.replace(LogSeqRegExes.BEGIN_BLOCK_REGEX, "<blockquote> &#9759;");
                replacedBlock = replacedBlock.replace(LogSeqRegExes.END_BLOCK_REGEX, "</blockquote>");
                entry.innerHTML = replacedBlock;
            }
            var taskType = LogSeqRegExes.parseTaskType(entry.textContent);
            if (taskType == TaskType.DONE) {
                LogSeqPlugin.processChildren(entry, TaskType.DONE);
                entry.insertAdjacentElement("afterbegin", createCheckboxElement(true));
                LogSeqPlugin.styleNode(entry, TaskCSSClass.COMPLETE);
            }
            else if (taskType == TaskType.TODO) {
                LogSeqPlugin.processChildren(entry, TaskType.TODO);
                entry.insertAdjacentElement("afterbegin", createKeywordElement(TaskType.TODO));
                entry.insertAdjacentElement("afterbegin", createCheckboxElement());
                LogSeqPlugin.styleNode(entry, TaskCSSClass.INCOMPLETE);
            }
            else if (taskType == TaskType.DOING) {
                LogSeqPlugin.processChildren(entry, TaskType.DOING);
                entry.insertAdjacentElement("afterbegin", createKeywordElement(TaskType.DOING));
                entry.insertAdjacentElement("afterbegin", createCheckboxElement());
            }
            else if (taskType == TaskType.LATER) {
                LogSeqPlugin.processChildren(entry, TaskType.LATER);
                entry.insertAdjacentElement("afterbegin", createKeywordElement(TaskType.LATER));
                entry.insertAdjacentElement("afterbegin", createCheckboxElement());
                LogSeqPlugin.styleNode(entry, TaskCSSClass.INCOMPLETE);
            }
            else if (taskType == TaskType.CANCELED) {
                LogSeqPlugin.processChildren(entry, TaskType.CANCELED);
                LogSeqPlugin.styleNode(entry, TaskCSSClass.COMPLETE);
            }
        });
    };
    return LogSeqPlugin;
}(obsidian.Plugin));

module.exports = LogSeqPlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsibm9kZV9tb2R1bGVzL3RzbGliL3RzbGliLmVzNi5qcyIsIm1haW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbkNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLlxyXG5cclxuUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55XHJcbnB1cnBvc2Ugd2l0aCBvciB3aXRob3V0IGZlZSBpcyBoZXJlYnkgZ3JhbnRlZC5cclxuXHJcblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEhcclxuUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZXHJcbkFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCxcclxuSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NXHJcbkxPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SXHJcbk9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1JcclxuUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi9cclxuLyogZ2xvYmFsIFJlZmxlY3QsIFByb21pc2UgKi9cclxuXHJcbnZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24oZCwgYikge1xyXG4gICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHRlbmRzKGQsIGIpIHtcclxuICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxufVxyXG5cclxuZXhwb3J0IHZhciBfX2Fzc2lnbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uIF9fYXNzaWduKHQpIHtcclxuICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKSB0W3BdID0gc1twXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcmVzdChzLCBlKSB7XHJcbiAgICB2YXIgdCA9IHt9O1xyXG4gICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApICYmIGUuaW5kZXhPZihwKSA8IDApXHJcbiAgICAgICAgdFtwXSA9IHNbcF07XHJcbiAgICBpZiAocyAhPSBudWxsICYmIHR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID09PSBcImZ1bmN0aW9uXCIpXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIHAgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHMpOyBpIDwgcC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoZS5pbmRleE9mKHBbaV0pIDwgMCAmJiBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwocywgcFtpXSkpXHJcbiAgICAgICAgICAgICAgICB0W3BbaV1dID0gc1twW2ldXTtcclxuICAgICAgICB9XHJcbiAgICByZXR1cm4gdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3BhcmFtKHBhcmFtSW5kZXgsIGRlY29yYXRvcikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSkgeyBkZWNvcmF0b3IodGFyZ2V0LCBrZXksIHBhcmFtSW5kZXgpOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX21ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKSB7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZ2VuZXJhdG9yKHRoaXNBcmcsIGJvZHkpIHtcclxuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XHJcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xyXG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcclxuICAgICAgICB3aGlsZSAoXykgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xyXG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XHJcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxyXG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgdmFyIF9fY3JlYXRlQmluZGluZyA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcclxuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XHJcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XHJcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xyXG4gICAgb1trMl0gPSBtW2tdO1xyXG59KTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2V4cG9ydFN0YXIobSwgbykge1xyXG4gICAgZm9yICh2YXIgcCBpbiBtKSBpZiAocCAhPT0gXCJkZWZhdWx0XCIgJiYgIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvLCBwKSkgX19jcmVhdGVCaW5kaW5nKG8sIG0sIHApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX192YWx1ZXMobykge1xyXG4gICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDtcclxuICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pO1xyXG4gICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSBcIm51bWJlclwiKSByZXR1cm4ge1xyXG4gICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDtcclxuICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyBcIk9iamVjdCBpcyBub3QgaXRlcmFibGUuXCIgOiBcIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3JlYWQobywgbikge1xyXG4gICAgdmFyIG0gPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdO1xyXG4gICAgaWYgKCFtKSByZXR1cm4gbztcclxuICAgIHZhciBpID0gbS5jYWxsKG8pLCByLCBhciA9IFtdLCBlO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICB3aGlsZSAoKG4gPT09IHZvaWQgMCB8fCBuLS0gPiAwKSAmJiAhKHIgPSBpLm5leHQoKSkuZG9uZSkgYXIucHVzaChyLnZhbHVlKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlcnJvcikgeyBlID0geyBlcnJvcjogZXJyb3IgfTsgfVxyXG4gICAgZmluYWxseSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKHIgJiYgIXIuZG9uZSAmJiAobSA9IGlbXCJyZXR1cm5cIl0pKSBtLmNhbGwoaSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZpbmFsbHkgeyBpZiAoZSkgdGhyb3cgZS5lcnJvcjsgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFyO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWQoKSB7XHJcbiAgICBmb3IgKHZhciBhciA9IFtdLCBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKylcclxuICAgICAgICBhciA9IGFyLmNvbmNhdChfX3JlYWQoYXJndW1lbnRzW2ldKSk7XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZEFycmF5cygpIHtcclxuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xyXG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxyXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxyXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcclxuICAgIHJldHVybiByO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgaWYgKGdbbl0pIGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAocikgeyByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsgfVxyXG4gICAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoXCJuZXh0XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0RlbGVnYXRvcihvKSB7XHJcbiAgICB2YXIgaSwgcDtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiwgZnVuY3Rpb24gKGUpIHsgdGhyb3cgZTsgfSksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaVtuXSA9IG9bbl0gPyBmdW5jdGlvbiAodikgeyByZXR1cm4gKHAgPSAhcCkgPyB7IHZhbHVlOiBfX2F3YWl0KG9bbl0odikpLCBkb25lOiBuID09PSBcInJldHVyblwiIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xyXG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcclxuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydFN0YXIobW9kKSB7XHJcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xyXG4gICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xyXG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydERlZmF1bHQobW9kKSB7XHJcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IGRlZmF1bHQ6IG1vZCB9O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEdldChyZWNlaXZlciwgcHJpdmF0ZU1hcCkge1xyXG4gICAgaWYgKCFwcml2YXRlTWFwLmhhcyhyZWNlaXZlcikpIHtcclxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiYXR0ZW1wdGVkIHRvIGdldCBwcml2YXRlIGZpZWxkIG9uIG5vbi1pbnN0YW5jZVwiKTtcclxuICAgIH1cclxuICAgIHJldHVybiBwcml2YXRlTWFwLmdldChyZWNlaXZlcik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KHJlY2VpdmVyLCBwcml2YXRlTWFwLCB2YWx1ZSkge1xyXG4gICAgaWYgKCFwcml2YXRlTWFwLmhhcyhyZWNlaXZlcikpIHtcclxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiYXR0ZW1wdGVkIHRvIHNldCBwcml2YXRlIGZpZWxkIG9uIG5vbi1pbnN0YW5jZVwiKTtcclxuICAgIH1cclxuICAgIHByaXZhdGVNYXAuc2V0KHJlY2VpdmVyLCB2YWx1ZSk7XHJcbiAgICByZXR1cm4gdmFsdWU7XHJcbn1cclxuIiwiaW1wb3J0IHtcclxuICBNYXJrZG93blBvc3RQcm9jZXNzb3IsXHJcbiAgTWFya2Rvd25Qb3N0UHJvY2Vzc29yQ29udGV4dCxcclxuICBQbHVnaW4sXHJcbn0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcblxyXG5lbnVtIFRhc2tUeXBlIHtcclxuICBUT0RPID0gXCJUT0RPXCIsXHJcbiAgRE9ORSA9IFwiRE9ORVwiLFxyXG4gIERPSU5HID0gXCJET0lOR1wiLFxyXG4gIExBVEVSID0gXCJMQVRFUlwiLFxyXG4gIENBTkNFTEVEID0gXCJDQU5DRUxFRFwiLFxyXG4gIFVOS05PV04gPSBcIlVOS05PV05cIixcclxufVxyXG5cclxuZW51bSBUYXNrQ1NTQ2xhc3Mge1xyXG4gIENPTVBMRVRFID0gXCJsb2dzZXEtY29tcGxldGUtdGFza1wiLFxyXG4gIElOQ09NUExFVEUgPSBcImxvZ3NlcS1pbmNvbXBsZXRlLXRhc2tcIixcclxuICBLRVlXT1JEID0gXCJsb2dzZXEta2V5d29yZFwiLFxyXG59XHJcblxyXG5jb25zdCBWRVJTSU9OID0gXCIwLjAuNFwiO1xyXG5cclxuY2xhc3MgTG9nU2VxUmVnRXhlcyB7XHJcbiAgc3RhdGljIHBhcnNlVGFza1R5cGUoY29udGVudDogc3RyaW5nKTogVGFza1R5cGUge1xyXG4gICAgaWYgKGNvbnRlbnQuc3RhcnRzV2l0aChcIkRPTkUgXCIpKSB7XHJcbiAgICAgIHJldHVybiBUYXNrVHlwZS5ET05FO1xyXG4gICAgfSBlbHNlIGlmIChjb250ZW50LnN0YXJ0c1dpdGgoXCJUT0RPIFwiKSkge1xyXG4gICAgICByZXR1cm4gVGFza1R5cGUuVE9ETztcclxuICAgIH0gZWxzZSBpZiAoY29udGVudC5zdGFydHNXaXRoKFwiRE9JTkcgXCIpKSB7XHJcbiAgICAgIHJldHVybiBUYXNrVHlwZS5ET0lORztcclxuICAgIH0gZWxzZSBpZiAoY29udGVudC5zdGFydHNXaXRoKFwiTEFURVIgXCIpKSB7XHJcbiAgICAgIHJldHVybiBUYXNrVHlwZS5MQVRFUjtcclxuICAgIH0gZWxzZSBpZiAoY29udGVudC5zdGFydHNXaXRoKFwiQ0FOQ0VMRUQgXCIpKSB7XHJcbiAgICAgIHJldHVybiBUYXNrVHlwZS5DQU5DRUxFRDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBUYXNrVHlwZS5VTktOT1dOO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc3RhdGljIEhFQURJTkdfUkVHRVggPSB7XHJcbiAgICBoMTogLyg/OlxccyspPy0gIyAoPzouKikkL2dtcyxcclxuICAgIGgyOiAvKD86XFxzKyk/LSAjIyAoPzouKikkL2dtcyxcclxuICAgIGgzOiAvKD86XFxzKyk/LSAjIyMgKD86LiopJC9nbXMsXHJcbiAgICBoNDogLyg/OlxccyspPy0gIyMjIyAoPzouKikkL2dtcyxcclxuICAgIGg1OiAvKD86XFxzKyk/LSAjIyMjIyAoPzouKikkL2dtcyxcclxuICB9O1xyXG5cclxuICBzdGF0aWMgQkVHSU5fQkxPQ0tfUkVHRVggPSBuZXcgUmVnRXhwKFxyXG4gICAgL1xcI1xcK0JFR0lOXyhXQVJOSU5HfElNUE9SVEFOVHxRVU9URXxDQVVUSU9OKS9nbXNcclxuICApO1xyXG4gIHN0YXRpYyBFTkRfQkxPQ0tfUkVHRVggPSBuZXcgUmVnRXhwKFxyXG4gICAgL1xcI1xcK0VORF8oV0FSTklOR3xJTVBPUlRBTlR8UVVPVEV8Q0FVVElPTikvZ21zXHJcbiAgKTtcclxuXHJcbiAgc3RhdGljIGlzQmxvY2soY29udGVudDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gTG9nU2VxUmVnRXhlcy5CRUdJTl9CTE9DS19SRUdFWC50ZXN0KGNvbnRlbnQpO1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgQ29kZU1pcnJvck92ZXJsYXlzIHtcclxuICBzdGF0aWMgaGVhZGluZ3NPdmVybGF5ID0ge1xyXG4gICAgdG9rZW46IChzdHJlYW06IGFueSkgPT4ge1xyXG4gICAgICBpZiAoc3RyZWFtLm1hdGNoKExvZ1NlcVJlZ0V4ZXMuSEVBRElOR19SRUdFWFtcImgxXCJdKSkge1xyXG4gICAgICAgIHJldHVybiBcImhlYWRlci0xXCI7XHJcbiAgICAgIH0gZWxzZSBpZiAoc3RyZWFtLm1hdGNoKExvZ1NlcVJlZ0V4ZXMuSEVBRElOR19SRUdFWFtcImgyXCJdKSkge1xyXG4gICAgICAgIHJldHVybiBcImhlYWRlci0yXCI7XHJcbiAgICAgIH0gZWxzZSBpZiAoc3RyZWFtLm1hdGNoKExvZ1NlcVJlZ0V4ZXMuSEVBRElOR19SRUdFWFtcImgzXCJdKSkge1xyXG4gICAgICAgIHJldHVybiBcImhlYWRlci0zXCI7XHJcbiAgICAgIH0gZWxzZSBpZiAoc3RyZWFtLm1hdGNoKExvZ1NlcVJlZ0V4ZXMuSEVBRElOR19SRUdFWFtcImg0XCJdKSkge1xyXG4gICAgICAgIHJldHVybiBcImhlYWRlci00XCI7XHJcbiAgICAgIH0gZWxzZSBpZiAoc3RyZWFtLm1hdGNoKExvZ1NlcVJlZ0V4ZXMuSEVBRElOR19SRUdFWFtcImg1XCJdKSkge1xyXG4gICAgICAgIHJldHVybiBcImhlYWRlci01XCI7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgc3RyZWFtLm5leHQoKTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuICB9O1xyXG4gIHN0YXRpYyBjbUFkZEhlYWRpbmdPdmVybGF5KGNtOiBDb2RlTWlycm9yLkVkaXRvcikge1xyXG4gICAgY20uYWRkT3ZlcmxheShDb2RlTWlycm9yT3ZlcmxheXMuaGVhZGluZ3NPdmVybGF5KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBjbVJlbW92ZUhlYWRpbmdPdmVybGF5KGNtOiBDb2RlTWlycm9yLkVkaXRvcikge1xyXG4gICAgY20ucmVtb3ZlT3ZlcmxheShDb2RlTWlycm9yT3ZlcmxheXMuaGVhZGluZ3NPdmVybGF5KTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZUtleXdvcmRFbGVtZW50KGtleXdvcmQ6IHN0cmluZyk6IEhUTUxFbGVtZW50IHtcclxuICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKFRhc2tDU1NDbGFzcy5LRVlXT1JEKTtcclxuICBlbGVtZW50LnRleHRDb250ZW50ID0ga2V5d29yZDtcclxuICByZXR1cm4gZWxlbWVudDtcclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlQ2hlY2tib3hFbGVtZW50KGNoZWNrZWQ6IGJvb2xlYW4gPSBmYWxzZSk6IEhUTUxFbGVtZW50IHtcclxuICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xyXG4gIGVsZW1lbnQudHlwZSA9IFwiY2hlY2tib3hcIjtcclxuICBlbGVtZW50LmNoZWNrZWQgPSBjaGVja2VkO1xyXG4gIHJldHVybiBlbGVtZW50O1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMb2dTZXFQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xyXG4gIHN0YXRpYyByZW1vdmVQcm9wZXJ0aWVzKGNvbnRlbnQ6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gY29udGVudFxyXG4gICAgICAucmVwbGFjZSgvZG9pbmc6OiAoPzpcXGR7MTN9KS8sIFwiXCIpXHJcbiAgICAgIC5yZXBsYWNlKC9kb25lOjogKD86XFxkezEzfSkvLCBcIlwiKVxyXG4gICAgICAucmVwbGFjZSgvdG9kbzo6ICg/OlxcZHsxM30pLywgXCJcIilcclxuICAgICAgLnJlcGxhY2UoL2RvaW5nOjogKD86XFxkezEzfSkvLCBcIlwiKVxyXG4gICAgICAucmVwbGFjZSgvbGF0ZXI6OiAoPzpcXGR7MTN9KS8sIFwiXCIpXHJcbiAgICAgIC5yZXBsYWNlKC9jYW5jZWxlZDo6ICg/OlxcZHsxM30pLywgXCJcIilcclxuICAgICAgLnJlcGxhY2UoXHJcbiAgICAgICAgL2lkOjogKD86WzAtOUEtRl17OH0tWzAtOUEtRl17NH0tNFswLTlBLUZdezN9LVs4OUFCXVswLTlBLUZdezN9LVswLTlBLUZdezEyfSkvaSxcclxuICAgICAgICBcIlwiXHJcbiAgICAgIClcclxuICAgICAgLnJlcGxhY2UoL2NvbGxhcHNlZDo6ICg/OnRydWV8ZmFsc2UpL2dtcywgXCJcIik7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcHJvY2Vzc0NoaWxkcmVuKGVsOiBFbGVtZW50LCBrZXl3b3JkOiBzdHJpbmcpIHtcclxuICAgIGVsLmNoaWxkTm9kZXMuZm9yRWFjaCgoY2hpbGQpID0+IHtcclxuICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09IE5vZGUuVEVYVF9OT0RFKSB7XHJcbiAgICAgICAgaWYgKGNoaWxkLm5vZGVWYWx1ZS5zdGFydHNXaXRoKGtleXdvcmQpKSB7XHJcbiAgICAgICAgICBjaGlsZC5ub2RlVmFsdWUgPSBjaGlsZC5ub2RlVmFsdWUucmVwbGFjZShrZXl3b3JkLCBcIlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2hpbGQubm9kZVZhbHVlID0gTG9nU2VxUGx1Z2luLnJlbW92ZVByb3BlcnRpZXMoY2hpbGQubm9kZVZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgc3R5bGVOb2RlKGVsOiBFbGVtZW50LCBjbGFzc25hbWU6IFRhc2tDU1NDbGFzcykge1xyXG4gICAgZWwucXVlcnlTZWxlY3RvckFsbChcImxpW2RhdGEtbGluZV1cIikuZm9yRWFjaCgoY2hpbGQpID0+IHtcclxuICAgICAgLy8gRG8gbm90IFwiY29tcGxldGVcIiB0aGUgY2hpbGQgdGFza3MsIHNpbmNlIHRoaXMgaXMgTG9nU2VxJ3MgYmVoYXZpb3VyXHJcbiAgICAgIGNoaWxkLmNsYXNzTGlzdC5hZGQoVGFza0NTU0NsYXNzLklOQ09NUExFVEUpO1xyXG4gICAgfSk7XHJcbiAgICBlbC5jbGFzc0xpc3QuYWRkKGNsYXNzbmFtZSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcG9zdHByb2Nlc3NvcjogTWFya2Rvd25Qb3N0UHJvY2Vzc29yID0gKFxyXG4gICAgZWw6IEhUTUxFbGVtZW50LFxyXG4gICAgY3R4OiBNYXJrZG93blBvc3RQcm9jZXNzb3JDb250ZXh0XHJcbiAgKSA9PiB7XHJcbiAgICBjb25zdCBlbnRyaWVzID0gZWwucXVlcnlTZWxlY3RvckFsbChcImxpW2RhdGEtbGluZV1cIik7XHJcblxyXG4gICAgZW50cmllcy5mb3JFYWNoKChlbnRyeSkgPT4ge1xyXG4gICAgICAvLyBDaGVjayBpZiB0aGUgZW50cnkgaXMgYSBvcmctbW9kZSBibG9ja1xyXG4gICAgICBpZiAoTG9nU2VxUmVnRXhlcy5pc0Jsb2NrKGVudHJ5LmlubmVySFRNTCkpIHtcclxuICAgICAgICBsZXQgcmVwbGFjZWRCbG9jayA9IGVudHJ5LmlubmVySFRNTC5yZXBsYWNlKFxyXG4gICAgICAgICAgTG9nU2VxUmVnRXhlcy5CRUdJTl9CTE9DS19SRUdFWCxcclxuICAgICAgICAgIFwiPGJsb2NrcXVvdGU+ICYjOTc1OTtcIlxyXG4gICAgICAgICk7XHJcbiAgICAgICAgcmVwbGFjZWRCbG9jayA9IHJlcGxhY2VkQmxvY2sucmVwbGFjZShcclxuICAgICAgICAgIExvZ1NlcVJlZ0V4ZXMuRU5EX0JMT0NLX1JFR0VYLFxyXG4gICAgICAgICAgXCI8L2Jsb2NrcXVvdGU+XCJcclxuICAgICAgICApO1xyXG4gICAgICAgIGVudHJ5LmlubmVySFRNTCA9IHJlcGxhY2VkQmxvY2s7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgdGFza1R5cGUgPSBMb2dTZXFSZWdFeGVzLnBhcnNlVGFza1R5cGUoZW50cnkudGV4dENvbnRlbnQpO1xyXG5cclxuICAgICAgaWYgKHRhc2tUeXBlID09IFRhc2tUeXBlLkRPTkUpIHtcclxuICAgICAgICBMb2dTZXFQbHVnaW4ucHJvY2Vzc0NoaWxkcmVuKGVudHJ5LCBUYXNrVHlwZS5ET05FKTtcclxuXHJcbiAgICAgICAgZW50cnkuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KFwiYWZ0ZXJiZWdpblwiLCBjcmVhdGVDaGVja2JveEVsZW1lbnQodHJ1ZSkpO1xyXG4gICAgICAgIExvZ1NlcVBsdWdpbi5zdHlsZU5vZGUoZW50cnksIFRhc2tDU1NDbGFzcy5DT01QTEVURSk7XHJcbiAgICAgIH0gZWxzZSBpZiAodGFza1R5cGUgPT0gVGFza1R5cGUuVE9ETykge1xyXG4gICAgICAgIExvZ1NlcVBsdWdpbi5wcm9jZXNzQ2hpbGRyZW4oZW50cnksIFRhc2tUeXBlLlRPRE8pO1xyXG5cclxuICAgICAgICBlbnRyeS5pbnNlcnRBZGphY2VudEVsZW1lbnQoXHJcbiAgICAgICAgICBcImFmdGVyYmVnaW5cIixcclxuICAgICAgICAgIGNyZWF0ZUtleXdvcmRFbGVtZW50KFRhc2tUeXBlLlRPRE8pXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgZW50cnkuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KFwiYWZ0ZXJiZWdpblwiLCBjcmVhdGVDaGVja2JveEVsZW1lbnQoKSk7XHJcbiAgICAgICAgTG9nU2VxUGx1Z2luLnN0eWxlTm9kZShlbnRyeSwgVGFza0NTU0NsYXNzLklOQ09NUExFVEUpO1xyXG4gICAgICB9IGVsc2UgaWYgKHRhc2tUeXBlID09IFRhc2tUeXBlLkRPSU5HKSB7XHJcbiAgICAgICAgTG9nU2VxUGx1Z2luLnByb2Nlc3NDaGlsZHJlbihlbnRyeSwgVGFza1R5cGUuRE9JTkcpO1xyXG5cclxuICAgICAgICBlbnRyeS5pbnNlcnRBZGphY2VudEVsZW1lbnQoXHJcbiAgICAgICAgICBcImFmdGVyYmVnaW5cIixcclxuICAgICAgICAgIGNyZWF0ZUtleXdvcmRFbGVtZW50KFRhc2tUeXBlLkRPSU5HKVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGVudHJ5Lmluc2VydEFkamFjZW50RWxlbWVudChcImFmdGVyYmVnaW5cIiwgY3JlYXRlQ2hlY2tib3hFbGVtZW50KCkpO1xyXG4gICAgICB9IGVsc2UgaWYgKHRhc2tUeXBlID09IFRhc2tUeXBlLkxBVEVSKSB7XHJcbiAgICAgICAgTG9nU2VxUGx1Z2luLnByb2Nlc3NDaGlsZHJlbihlbnRyeSwgVGFza1R5cGUuTEFURVIpO1xyXG5cclxuICAgICAgICBlbnRyeS5pbnNlcnRBZGphY2VudEVsZW1lbnQoXHJcbiAgICAgICAgICBcImFmdGVyYmVnaW5cIixcclxuICAgICAgICAgIGNyZWF0ZUtleXdvcmRFbGVtZW50KFRhc2tUeXBlLkxBVEVSKVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGVudHJ5Lmluc2VydEFkamFjZW50RWxlbWVudChcImFmdGVyYmVnaW5cIiwgY3JlYXRlQ2hlY2tib3hFbGVtZW50KCkpO1xyXG4gICAgICAgIExvZ1NlcVBsdWdpbi5zdHlsZU5vZGUoZW50cnksIFRhc2tDU1NDbGFzcy5JTkNPTVBMRVRFKTtcclxuICAgICAgfSBlbHNlIGlmICh0YXNrVHlwZSA9PSBUYXNrVHlwZS5DQU5DRUxFRCkge1xyXG4gICAgICAgIExvZ1NlcVBsdWdpbi5wcm9jZXNzQ2hpbGRyZW4oZW50cnksIFRhc2tUeXBlLkNBTkNFTEVEKTtcclxuICAgICAgICBMb2dTZXFQbHVnaW4uc3R5bGVOb2RlKGVudHJ5LCBUYXNrQ1NTQ2xhc3MuQ09NUExFVEUpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICBvbmxvYWQoKSB7XHJcbiAgICBjb25zb2xlLmxvZyhgTG9hZGluZyBsb2dzZXEtY29tcGF0IHBsdWdpbiAke1ZFUlNJT059YCk7XHJcbiAgICB0aGlzLnJlZ2lzdGVyTWFya2Rvd25Qb3N0UHJvY2Vzc29yKExvZ1NlcVBsdWdpbi5wb3N0cHJvY2Vzc29yKTtcclxuICAgIC8vIFN0eWxlIGhlYWRpbmdzIGluIHNvdXJjZSBlZGl0aW5nXHJcbiAgICB0aGlzLnJlZ2lzdGVyQ29kZU1pcnJvcihDb2RlTWlycm9yT3ZlcmxheXMuY21BZGRIZWFkaW5nT3ZlcmxheSk7XHJcbiAgfVxyXG5cclxuICBvbnVubG9hZCgpIHtcclxuICAgIGNvbnNvbGUubG9nKGB1bmxvYWRpbmcgbG9nc2VxLWNvbXBhdCBwbHVnaW4gJHtWRVJTSU9OfWApO1xyXG4gICAgdGhpcy5yZWdpc3RlckNvZGVNaXJyb3IoQ29kZU1pcnJvck92ZXJsYXlzLmNtUmVtb3ZlSGVhZGluZ092ZXJsYXkpO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiUGx1Z2luIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLGFBQWEsR0FBRyxTQUFTLENBQUMsRUFBRSxDQUFDLEVBQUU7QUFDbkMsSUFBSSxhQUFhLEdBQUcsTUFBTSxDQUFDLGNBQWM7QUFDekMsU0FBUyxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQUUsWUFBWSxLQUFLLElBQUksVUFBVSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLFNBQVMsR0FB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
